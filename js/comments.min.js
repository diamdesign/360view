import{getTimeAgo,formatNumber,countComments}from"./functions.min.js";import{installEmoji}from"./emoji.min.js";export function buildComments(e,t,n){const a=e.allowcomments,s=e.comments;console.log("Building comments...");const r=t.id,i="https://360.com/profile/",l=document.querySelector("#comments");l.innerHTML="";var o=`<h4 class="amount-comments">${countComments(s)} comments</h4>\n                <div id="closecommentsbtn"></div><div class="container">`;if(a)try{s.map((e=>{let n=e.user_id;o+=`<div class="comment" data-id="${e.id}">\n                        <a href="${i+e.username}" class="thumb"  target="_blank">\n                            <img src="${e.thumbnail}" alt="" />\n                        </a>\n                        <div class="commentinfo">\n                            <a href="${i+e.username}" class="profilename" target="_blank">\n                                ${e.username}`,n===r&&(o+='<span class="creator">· Creator</span>'),o+=`</a>\n                            <p class="message">${e.comment}</p>\n                            <span class="timeago">${getTimeAgo(e.registered)}</span>\n                            <a href="#like" class="likecomment${e.has_liked?" likedcomment":""}" data-hasliked="${e.has_liked}" data-id="${e.id}">\n                                <svg viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg">\n                                    <rect fill="none" height="256" width="256" />\n                                    <path\n                                        d="M176,32a60,60,0,0,0-48,24A60,60,0,0,0,20,92c0,71.9,99.9,128.6,104.1,131a7.8,7.8,0,0,0,3.9,1,7.6,7.6,0,0,0,3.9-1,314.3,314.3,0,0,0,51.5-37.6C218.3,154,236,122.6,236,92A60,60,0,0,0,176,32Z"\n                                    />\n                                </svg>\n                                <span>\n                                ${formatNumber(e.likes_count).trim()}\n                                </span>\n                            </a>\n                            <a href="#reply" class="replybtn" data-id="${e.id}" data-name="${e.username}">Reply</a>\n                        </div>\n                    </div>`,e.replies&&e.replies.length>0&&(o+=`<div class="replies"><div class="btn-showreplies">+ View ${e.replies.length} replies</div><div class="replies-container">`,e.replies.map((e=>{let n=e.user_id;o+=`<div class="comment reply" data-id="${e.id}" data-reply_id="${e.reply_id}" data-parent_id="${e.parent_id}">\n                                <a href="${i+e.username}" class="thumb" target="_blank"><img src="${e.thumbnail}" alt="" /></a>\n                                <div class="commentinfo">\n                                    <div class="repliedto">\n                                        <a href="${i+e.username}" class="profilename" target="_blank">${e.username}`,n===r&&(o+='<span class="creator">· Creator</span>'),o+=`</a> > <a href="${i+e.reply_username}" class="profilename replyto" target="_blank">${e.reply_username}`,e.reply_username===t.username&&(o+='<span class="creator">· Creator</span>'),o+=`</a>\n                                    </div>\n                                    <p class="message">${e.comment}</p>\n                                    <span class="timeago">${getTimeAgo(e.registered)}</span>\n                                    <a href="#like" class="likecomment${e.has_liked?" likedcomment":""}" data-hasliked="${e.has_liked}" data-id="${e.id}">\n                                        <svg viewBox="0 0 256 256" xmlns="http://www.w3.org/2000/svg">\n                                            <rect fill="none" height="256" width="256" />\n                                            <path\n                                                d="M176,32a60,60,0,0,0-48,24A60,60,0,0,0,20,92c0,71.9,99.9,128.6,104.1,131a7.8,7.8,0,0,0,3.9,1,7.6,7.6,0,0,0,3.9-1,314.3,314.3,0,0,0,51.5-37.6C218.3,154,236,122.6,236,92A60,60,0,0,0,176,32Z"\n                                            />\n                                        </svg>\n                                        <span>\n                                        ${formatNumber(e.likes_count).trim()}\n                                        </span>\n                                    </a>\n                                    <a href="#reply" class="replybtn" data-id="${e.id}" data-parent_id="${e.parent_id}" data-name="${e.username}">Reply</a>\n                                </div>\n                                \n                            </div>`})),o+='</div><div class="hide-replies">- Hide replies</div></div>')}))}catch(e){console.error("Error occurred during mapping:",e)}else o+='<div style="padding:2rem;">Creator has disabled comments.</div>';o+='</div>\n            <div class="writecomment">\n                <div class="thumb"></div>\n                <div id="emojiplugin"></div>\n            </div>',l.innerHTML=o,console.log("Building comments complete...");document.querySelectorAll(".btn-showreplies").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault();let t=e.target.parentNode.querySelector(".replies-container");t?(t.style.display="block",e.target.style.display="none",e.target.parentNode.querySelector(".hide-replies").style.display="block"):console.error("Replies container not found.")}))}));document.querySelectorAll(".hide-replies").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault();let t=e.target.parentNode.querySelector(".replies-container");t?(t.style.display="none",e.target.style.display="none",e.target.parentNode.querySelector(".btn-showreplies").style.display="block"):console.error("Replies container not found.")}))}));const d=document.querySelector(".writecomment");if(n){let e=`<a href="https://360.com/profile/${n.username}" target="_blank" class="thumb">\n\t\t\t\t<img src="${n.thumbnail}" alt="" /></a><div id="emojiplugin"></div>`;d.innerHTML=e,installEmoji("emojiplugin");const t=document.querySelectorAll(".replybtn"),a=document.querySelector("#commentInputField");t.forEach((e=>{e.addEventListener("click",(e=>{let t=e.target.getAttribute("data-name"),n=e.target.getAttribute("data-id");a.placeholder="Reply to "+t,a.dataset.replytoid=n,a.focus()}))}));document.querySelectorAll(".likecomment").forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault();let t=e.target.closest(".likecomment"),n=t.querySelector("span"),a=parseInt(n.textContent.trim());t.classList.contains("likedcomment")?(t.classList.remove("likedcomment"),a-=1):(t.classList.add("likedcomment"),a+=1),n.textContent=a.toString()}))})),a.addEventListener("keydown",(e=>{"Escape"===e.key&&(delete a.dataset.replytoid,a.placeholder="Write your comment",a.blur())}))}else{const e="";d.innerHTML=e}}